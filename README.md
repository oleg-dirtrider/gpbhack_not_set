# rtdm_analyze
Утилита для анализа взимосвязей кампаний SAS RTDM и дата-поцесов которые используются в этих кампаниях
Утилита может работать из под win/mac/linux, запускается из командной строки.

# Зависимости 
- python >=3.6
- graphviz =2.47.2 (https://graphviz.org/download/ - необходимо утсановить на ос, для того чтобы отработала визуализация)
- requirements.txt - список python-библиотек

## Установка
1. Скачать саму утилиту:  
  ```git clone https://github.com/vasyanch/gpbhack_not_set.git```
2. Для запуска утилиты неоходимо подготовить для нее окружение:
   - перейти в папку куда Вы хотите её поставить
   - выполнить  
   ```python -v venv venv```  -> создание виртуального окружения python для изоляции от глобальных библиотек, 
     в результате создаться директория venv в папке из которой была запущенна команда
   - ативировать виртуальное окружение, выполнить команду:  
     windows ```venv\Scripts\activate.bat```  
     linux ```source venv/bin/activate```  
     mac ``````
    - выполнить  
  ```pip install -r requirements.txt``` -> установка python-зависимостей
     
## Запуск
Для того чтобы запустить утилиту необходимо задать пароли для подключений к серверу с SAS RTDM и операционной бд путем 
задания переменных окружения, список небходимых переменных лежит в файле rtdm_analyze/example.env

Утилита имеет command-line интерфейс и принимает следующие аргументы командной строки:
- campaign_name -> имя SAS кампании которую необходимо проанализировать, обязательная аргумент
- -l, --local -> булевый флаг, необязательная аргумент, с помощью нее указывается где запускается утилита:  
    - на рабочей машине(необходимо будет подключаться по ssh к серверу для получения .xml файлов с описанием SAS диаграмм),
  отсутствие флага
  - непосредстенно на сервере с SAS RTDM, наличие флага
- --export-package-log-file путь до лог-файла полученного после запуска утилиты SAS ExportPackage, необязатеьный аргумент,
  используется для того чтобы показать неиспользуемые дата-процессы в анализируемой кампании. Необходимо получть лог-файл
  на сервере, скачать его на машину где запускается утилита, передать путь до него через этот аргумент и программа выведет
  в stdout список неиспользуемых дата-поцессов
  
Пример запуска, перейти в папку rtdm_analyze:  
```python main.py HACK1_MAIN --export-package-log-file tmp\MetaDataObjects.txt```   

Пример вывода, последие строки вывода в stdout содержат названия неиспользуемых дата-процессов в анализируемой кампании: 
```
...
{log_msg}
... 
Found 5 unused data-processes:
CLIENT_v1
READ_ADDRESS_v1
READ_G_CHECKS
GRID_CLIENT
READ_DOCUMENT_v1.5
```

## Результат выполнения
Если утилита отработала без ошибок, то в результате:  
1. В операционной бд в схеме RTDM_TECH заполняются 4 таблицы:  
  - campaigns
  - campaigns_blocks
  - campaigns_blocks_data_processes_association
  - data_processes  
которые хранят зависимости между кампаниями -> блоками -> дата-процессами  
2. В папке rtdm_analyze/visualized_results появляются графическое представление взаимосвязи кампании -> дата-процессы


